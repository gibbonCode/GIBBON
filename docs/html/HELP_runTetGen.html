
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>runTetGen</title><meta name="generator" content="MATLAB 9.14"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2023-11-27"><meta name="DC.source" content="HELP_runTetGen.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>runTetGen</h1><!--introduction--><p>Below is a demonstration of the features of the <tt>runTetGen</tt> function</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Syntax</a></li><li><a href="#2">Description</a></li><li><a href="#3">Examples</a></li><li><a href="#6">Example 1: Meshing a model with a single region</a></li><li><a href="#11">Example 2: Meshing imported geometry</a></li><li><a href="#16">Example 3: Meshing a two-region model</a></li><li><a href="#21">Example 4: Meshing a multi-region model</a></li><li><a href="#27">Example 5: Meshing regions with holes</a></li><li><a href="#33">Example 6: Meshing from a quadrilateral input surface</a></li><li><a href="#37">Example 7: Specifying a sizing function to control local mesh density</a></li><li><a href="#43">Example 8: Meshing of topology with holes and complex regions</a></li><li><a href="#47">Example 9: Meshing 10-node (i.e. quadratic) tetrahedral elements</a></li></ul></div><h2 id="1">Syntax</h2><p><tt>[meshOutput]=runTetGen(inputStruct);</tt></p><h2 id="2">Description</h2><p>This function creates a temporary .smesh file which it passes to TETGEN (<a href="http://wias-berlin.de/software/tetgen/">http://wias-berlin.de/software/tetgen/</a>) for tetrahedral meshing. The input structure should contain the following fields:</p><p>smeshStruct.stringOpt=stringOpt; Where stringOpt should contain a strin composed of valid TETGEN command line switches (e.g. '-pq1.2VAaY'). See info below and the TETGEN manual.</p><p>smeshStruct.Faces=F; Where F is an array for all the model (triangular) faces</p><p>smeshStruct.Nodes=V; Where V is the array containing the nodal coordinates</p><p>smeshStruct.holePoints=V_holes; Where V_holes describes a point (not part of V) that lies inside a prescribed hole inside the mesh. If V_holes=[] no holes are defined.</p><p>smeshStruct.faceBoundaryMarker=faceBoundaryMarker; Where faceBoundaryMarker defines a label for each face denoting its membership to a particular boundary (e.g. all outer faces could have the same boundary label while an internal set of faces defining a hole has a different label).</p><p>smeshStruct.regionPoints=V_regions; Where similarly to V_holes the array V_regions defines points (not part of V) that lie inside a specific region (e.g. a material can be contained within another material and this allows you to specify multiple materials with different mesh densities and output labels).</p><p>smeshStruct.regionA=regionA; Where regionA is a vector defining the A specification (volume) for the corrensponding regions (as defined in V_regions)</p><p>Optional parameters:</p><p>smeshStruct.minRegionMarker=2; %Minimum region marker Arbitrary region marker label. Regions are labeled minRegionMarker:1:... for all regions.</p><p>smeshStruct.smeshName=smeshName; Where smeshName is the file name for the input .smesh file. Only .smesh files are currently supported as input files. This function generates the .smesh file using the <tt>writeBasicSmesh</tt> function</p><p>Below is a list of command line switches from the user manual:</p><p>-p Tetrahedralizes a piecewise linear complex (PLC). -Y Preserves the input surface mesh (does not modify it). -r Reconstructs a previously generated mesh. -q Refines mesh (to improve mesh quality). -R Mesh coarsening (to reduce the mesh elements). -A Assigns attributes to tetrahedra in different regions. -a Applies a maximum tetrahedron volume constraint. -m Applies a mesh sizing function. -i Inserts a list of additional points. -O Specifies the level of mesh optimization. -S Specifies maximum number of added points. -T Sets a tolerance for coplanar test (default 10?8). -X Suppresses use of exact arithmetic. -M No merge of coplanar facets or very close vertices. -w Generates weighted Delaunay (regular) triangulation. -c Retains the convex hull of the PLC. -d Detects self-intersections of facets of the PLC. -z Numbers all output items starting from zero. -f Outputs all faces to .face file. -e Outputs all edges to .edge file. -n Outputs tetrahedra neighbors to .neigh file. -v Outputs Voronoi diagram to files. -g Outputs mesh to .mesh file for viewing by Medit. -k Outputs mesh to .vtk file for viewing by Paraview. -J No jettison of unused vertices from output .node file. -B Suppresses output of boundary information. -N Suppresses output of .node file. -E Suppresses output of .ele file. -F Suppresses output of .face and .edge file. -I Suppresses mesh iteration numbers. -C Checks the consistency of the final mesh. -Q Quiet: No terminal output except errors. -V Verbose: Detailed information, more terminal output. -h Help: A brief instruction for using TetGen.</p><p>See the TETGEN manual for more information.</p><h2 id="3">Examples</h2><pre class="codeinput">clear; close <span class="string">all</span>; clc;
</pre><p>Plot settings</p><pre class="codeinput">fontSize=15;
faceAlpha1=0.3;
faceAlpha2=1;
cMap=gjet(4);
patchColor=cMap(1,:);
markerSize=25;
</pre><h2 id="6">Example 1: Meshing a model with a single region</h2><p>Creating geometry</p><pre class="codeinput">[F,V]=stanford_bunny(<span class="string">'g'</span>); <span class="comment">%Bunny</span>

C=ones(size(F,1),1); <span class="comment">%Face boundary markers (aka face colors)</span>
V_regions=getInnerPoint(F,V); <span class="comment">%Define region points</span>
V_holes=[]; <span class="comment">%Define hole points</span>
[regionTetVolumes]=tetVolMeanEst(F,V); <span class="comment">%Volume estimate for regular tets</span>
stringOpt=<span class="string">'-pq1.2AaY'</span>; <span class="comment">%Options for tetgen</span>
</pre><p>Mesh using TetGen</p><pre class="codeinput"><span class="comment">%Create tetgen input structure</span>
inputStruct.stringOpt=stringOpt; <span class="comment">%Tetgen options</span>
inputStruct.Faces=F; <span class="comment">%Boundary faces</span>
inputStruct.Nodes=V; <span class="comment">%Nodes of boundary</span>
inputStruct.faceBoundaryMarker=C;
inputStruct.regionPoints=V_regions; <span class="comment">%Interior points for regions</span>
inputStruct.holePoints=V_holes; <span class="comment">%Interior points for holes</span>
inputStruct.regionA=regionTetVolumes; <span class="comment">%Desired tetrahedral volume for each region</span>

<span class="comment">% Mesh model using tetrahedral elements using tetGen</span>
[meshOutput]=runTetGen(inputStruct); <span class="comment">%Run tetGen</span>
</pre><pre class="codeoutput"> 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- TETGEN Tetrahedral meshing --- 27-Nov-2023 11:03:09
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- Writing SMESH file --- 27-Nov-2023 11:03:09
----&gt; Adding node field
----&gt; Adding facet field
----&gt; Adding holes specification
----&gt; Adding region specification
--- Done --- 27-Nov-2023 11:03:09
--- Running TetGen to mesh input boundary--- 27-Nov-2023 11:03:09
Opening /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.smesh.
Delaunizing vertices...
Delaunay seconds:  0.004136
Creating surface mesh ...
Surface mesh seconds:  0.001305
Recovering boundaries...
Boundary recovery seconds:  0.002196
Removing exterior tetrahedra ...
Spreading region attributes.
Exterior tets removal seconds:  0.001294
Recovering Delaunayness...
Delaunay recovery seconds:  0.00117
Refining mesh...
  2026 insertions, added 1596 points, 52838 tetrahedra in queue.
  674 insertions, added 520 points, 63961 tetrahedra in queue.
  899 insertions, added 644 points, 76346 tetrahedra in queue.
  1198 insertions, added 716 points, 85093 tetrahedra in queue.
  1597 insertions, added 594 points, 66637 tetrahedra in queue.
  2129 insertions, added 315 points, 1474 tetrahedra in queue.
Refinement seconds:  0.057252
Smoothing vertices...
Mesh smoothing seconds:  0.100056
Improving mesh...
Mesh improvement seconds:  0.003621

Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.node.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.ele.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.face.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.edge.

Output seconds:  0.013841
Total running seconds:  0.184971

Statistics:

  Input points: 1520
  Input facets: 3036
  Input segments: 4554
  Input holes: 0
  Input regions: 1

  Mesh points: 6065
  Mesh tetrahedra: 32735
  Mesh faces: 66988
  Mesh faces on exterior boundary: 3036
  Mesh faces on input facets: 3036
  Mesh edges on input segments: 4554
  Steiner points inside domain: 4545

--- Done --- 27-Nov-2023 11:03:10
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- Importing TetGen files --- 27-Nov-2023 11:03:10
--- Done --- 27-Nov-2023 11:03:10
</pre><p>Access mesh output structure</p><pre class="codeinput">E=meshOutput.elements; <span class="comment">%The elements</span>
V=meshOutput.nodes; <span class="comment">%The vertices or nodes</span>
CE=meshOutput.elementMaterialID; <span class="comment">%Element material or region id</span>
Fb=meshOutput.facesBoundary; <span class="comment">%The boundary faces</span>
Cb=meshOutput.boundaryMarker; <span class="comment">%The boundary markers</span>
</pre><p>Visualization</p><pre class="codeinput">hf=cFigure;
subplot(1,2,1); hold <span class="string">on</span>;
title(<span class="string">'Input boundaries'</span>,<span class="string">'FontSize'</span>,fontSize);
hp(1)=gpatch(Fb,V,Cb,<span class="string">'k'</span>,faceAlpha1);
hp(2)=plotV(V_regions,<span class="string">'r.'</span>,<span class="string">'MarkerSize'</span>,markerSize);
legend(hp,{<span class="string">'Input mesh'</span>,<span class="string">'Interior point(s)'</span>},<span class="string">'Location'</span>,<span class="string">'NorthWestOutside'</span>);
axisGeom(gca,fontSize); camlight <span class="string">headlight</span>;
colormap(cMap); icolorbar;

hs=subplot(1,2,2); hold <span class="string">on</span>;
title(<span class="string">'Tetrahedral mesh'</span>,<span class="string">'FontSize'</span>,fontSize);

<span class="comment">% Visualizing using |meshView|</span>
optionStruct.hFig=[hf,hs];
meshView(meshOutput,optionStruct);

axisGeom(gca,fontSize);
gdrawnow;
</pre><img width="100%" height="auto" vspace="5" hspace="5" src="HELP_runTetGen_01.jpg" alt=""> <h2 id="11">Example 2: Meshing imported geometry</h2><p>Import an STL model</p><pre class="codeinput">defaultFolder = fileparts(fileparts(mfilename(<span class="string">'fullpath'</span>)));
pathName=fullfile(defaultFolder,<span class="string">'data'</span>,<span class="string">'STL'</span>);
fileName=fullfile(pathName,<span class="string">'femur.stl'</span>);
[stlStruct] = import_STL(fileName);

F=stlStruct.solidFaces{1};
V=stlStruct.solidVertices{1};

<span class="comment">% Merging nodes (nodes are not merged in stl)</span>
[F,V]=mergeVertices(F,V);

C=ones(size(F,1),1); <span class="comment">%Face boundary markers (aka face colors)</span>
V_regions=getInnerPoint(F,V); <span class="comment">%Define region points</span>
V_holes=[]; <span class="comment">%Define hole points</span>
[regionTetVolumes]=tetVolMeanEst(F,V); <span class="comment">%Volume estimate for regular tets</span>
stringOpt=<span class="string">'-pq1.2AaY'</span>; <span class="comment">%Options for tetgen</span>
</pre><p>Mesh using TetGen</p><pre class="codeinput"><span class="comment">%Create tetgen input structure</span>
inputStruct.stringOpt=stringOpt; <span class="comment">%Tetgen options</span>
inputStruct.Faces=F; <span class="comment">%Boundary faces</span>
inputStruct.Nodes=V; <span class="comment">%Nodes of boundary</span>
inputStruct.faceBoundaryMarker=C;
inputStruct.regionPoints=V_regions; <span class="comment">%Interior points for regions</span>
inputStruct.holePoints=V_holes; <span class="comment">%Interior points for holes</span>
inputStruct.regionA=regionTetVolumes; <span class="comment">%Desired tetrahedral volume for each region</span>

<span class="comment">% Mesh model using tetrahedral elements using tetGen</span>
[meshOutput]=runTetGen(inputStruct); <span class="comment">%Run tetGen</span>
</pre><pre class="codeoutput"> 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- TETGEN Tetrahedral meshing --- 27-Nov-2023 11:03:12
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- Writing SMESH file --- 27-Nov-2023 11:03:12
----&gt; Adding node field
----&gt; Adding facet field
----&gt; Adding holes specification
----&gt; Adding region specification
--- Done --- 27-Nov-2023 11:03:12
--- Running TetGen to mesh input boundary--- 27-Nov-2023 11:03:12
Opening /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.smesh.
Delaunizing vertices...
Delaunay seconds:  0.008425
Creating surface mesh ...
Surface mesh seconds:  0.002832
Recovering boundaries...
Boundary recovery seconds:  0.005207
Removing exterior tetrahedra ...
Spreading region attributes.
Exterior tets removal seconds:  0.003143
Recovering Delaunayness...
Delaunay recovery seconds:  0.002812
Refining mesh...
  3951 insertions, added 2867 points, 96839 tetrahedra in queue.
  1315 insertions, added 812 points, 113061 tetrahedra in queue.
  1753 insertions, added 908 points, 127021 tetrahedra in queue.
  2337 insertions, added 881 points, 127570 tetrahedra in queue.
  3115 insertions, added 603 points, 79813 tetrahedra in queue.
  4152 insertions, added 443 points, 4844 tetrahedra in queue.
Refinement seconds:  0.115455
Smoothing vertices...
Mesh smoothing seconds:  0.156151
Improving mesh...
Mesh improvement seconds:  0.005784

Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.node.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.ele.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.face.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.edge.

Output seconds:  0.020849
Total running seconds:  0.320851

Statistics:

  Input points: 2964
  Input facets: 5924
  Input segments: 8886
  Input holes: 0
  Input regions: 1

  Mesh points: 9835
  Mesh tetrahedra: 51987
  Mesh faces: 106936
  Mesh faces on exterior boundary: 5924
  Mesh faces on input facets: 5924
  Mesh edges on input segments: 8886
  Steiner points inside domain: 6871

--- Done --- 27-Nov-2023 11:03:13
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- Importing TetGen files --- 27-Nov-2023 11:03:13
--- Done --- 27-Nov-2023 11:03:13
</pre><p>Access mesh output structure</p><pre class="codeinput">E=meshOutput.elements; <span class="comment">%The elements</span>
V=meshOutput.nodes; <span class="comment">%The vertices or nodes</span>
CE=meshOutput.elementMaterialID; <span class="comment">%Element material or region id</span>
Fb=meshOutput.facesBoundary; <span class="comment">%The boundary faces</span>
Cb=meshOutput.boundaryMarker; <span class="comment">%The boundary markers</span>
</pre><p>Visualization</p><pre class="codeinput">hf=cFigure;
subplot(1,2,1); hold <span class="string">on</span>;
title(<span class="string">'Input boundaries'</span>,<span class="string">'FontSize'</span>,fontSize);
hp(1)=gpatch(Fb,V,Cb,<span class="string">'k'</span>,faceAlpha1);
hp(2)=plotV(V_regions,<span class="string">'r.'</span>,<span class="string">'MarkerSize'</span>,markerSize);
legend(hp,{<span class="string">'Input mesh'</span>,<span class="string">'Interior point(s)'</span>},<span class="string">'Location'</span>,<span class="string">'NorthWestOutside'</span>);
axisGeom(gca,fontSize); camlight <span class="string">headlight</span>;
colormap(cMap); icolorbar;

hs=subplot(1,2,2); hold <span class="string">on</span>;
title(<span class="string">'Tetrahedral mesh'</span>,<span class="string">'FontSize'</span>,fontSize);

<span class="comment">% Visualizing using |meshView|</span>
optionStruct.hFig=[hf,hs];
meshView(meshOutput,optionStruct);

axisGeom(gca,fontSize);
gdrawnow;
</pre><img width="100%" height="auto" vspace="5" hspace="5" src="HELP_runTetGen_02.jpg" alt=""> <h2 id="16">Example 3: Meshing a two-region model</h2><p>Create example geometry, here a torus containing a smaller torus</p><pre class="codeinput"><span class="comment">% An example surface</span>
r=2; <span class="comment">%Sphere radius</span>
rc=3; <span class="comment">%Central radius</span>
nr=20;
nc=30;
ptype=<span class="string">'tri'</span>;
[F1,V1]=patchTorus(r,nr,rc,nc,ptype);

r=1; <span class="comment">%Sphere radius</span>
rc=3; <span class="comment">%Central radius</span>
nr=15;
nc=25;
ptype=<span class="string">'tri'</span>;
[F2,V2]=patchTorus(r,nr,rc,nc,ptype);

[F,V,C]=joinElementSets({F1 F2},{V1 V2}); <span class="comment">%Join sets</span>

[V_region1]=getInnerPoint(F(C==2,:),V); <span class="comment">%First interior point</span>
[V_region2]=getInnerPoint({F1,F2},{V1,V2}); <span class="comment">%Second interior point</span>
V_regions=[V_region1; V_region2]; <span class="comment">%Collect region points</span>
V_holes=[]; <span class="comment">%Define hole points</span>
[regionTetVolume1]=tetVolMeanEst(F1,V1); <span class="comment">%Volume estimate for regular tets</span>
[regionTetVolume2]=tetVolMeanEst(F2,V2); <span class="comment">%Volume estimate for regular tets</span>
regionTetVolumes=[regionTetVolume1 regionTetVolume2];
stringOpt=<span class="string">'-pq1.2AaY'</span>; <span class="comment">%Tetgen options</span>
</pre><p>mesh using tet</p><pre class="codeinput"><span class="comment">%Create tetgen input structure</span>
inputStruct.stringOpt=stringOpt; <span class="comment">%Tetgen options</span>
inputStruct.Faces=F; <span class="comment">%Boundary faces</span>
inputStruct.Nodes=V; <span class="comment">%Nodes of boundary</span>
inputStruct.faceBoundaryMarker=C;
inputStruct.regionPoints=V_regions; <span class="comment">%Interior points for regions</span>
inputStruct.holePoints=V_holes; <span class="comment">%Interior points for holes</span>
inputStruct.regionA=regionTetVolumes; <span class="comment">%Desired tetrahedral volume for each region</span>

<span class="comment">% Mesh model using tetrahedral elements using tetGen</span>
[meshOutput]=runTetGen(inputStruct); <span class="comment">%Run tetGen</span>
</pre><pre class="codeoutput"> 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- TETGEN Tetrahedral meshing --- 27-Nov-2023 11:03:15
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- Writing SMESH file --- 27-Nov-2023 11:03:15
----&gt; Adding node field
----&gt; Adding facet field
----&gt; Adding holes specification
----&gt; Adding region specification
--- Done --- 27-Nov-2023 11:03:15
--- Running TetGen to mesh input boundary--- 27-Nov-2023 11:03:15
Opening /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.smesh.
Delaunizing vertices...
Delaunay seconds:  0.035199
Creating surface mesh ...
Surface mesh seconds:  0.000822
Recovering boundaries...
Boundary recovery seconds:  0.001646
Removing exterior tetrahedra ...
Spreading region attributes.
Exterior tets removal seconds:  0.000491
Recovering Delaunayness...
Delaunay recovery seconds:  0.009777
Refining mesh...
  1299 insertions, added 591 points, 18366 tetrahedra in queue.
  432 insertions, added 84 points, 18074 tetrahedra in queue.
  576 insertions, added 86 points, 16168 tetrahedra in queue.
  768 insertions, added 77 points, 10876 tetrahedra in queue.
  1023 insertions, added 43 points, 68 tetrahedra in queue.
  1364 insertions, added 66 points, 914 tetrahedra in queue.
Refinement seconds:  0.027616
Smoothing vertices...
Mesh smoothing seconds:  0.021496
Improving mesh...
Mesh improvement seconds:  0.001122

Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.node.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.ele.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.face.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.edge.

Output seconds:  0.004161
Total running seconds:  0.102419

Statistics:

  Input points: 975
  Input facets: 1950
  Input segments: 2925
  Input holes: 0
  Input regions: 2

  Mesh points: 1946
  Mesh tetrahedra: 10190
  Mesh faces: 20980
  Mesh faces on exterior boundary: 1200
  Mesh faces on input facets: 1950
  Mesh edges on input segments: 2925
  Steiner points inside domain: 971

--- Done --- 27-Nov-2023 11:03:15
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- Importing TetGen files --- 27-Nov-2023 11:03:15
--- Done --- 27-Nov-2023 11:03:15
</pre><p>Access mesh output structure</p><pre class="codeinput">E=meshOutput.elements; <span class="comment">%The elements</span>
V=meshOutput.nodes; <span class="comment">%The vertices or nodes</span>
CE=meshOutput.elementMaterialID; <span class="comment">%Element material or region id</span>
Fb=meshOutput.facesBoundary; <span class="comment">%The boundary faces</span>
Cb=meshOutput.boundaryMarker; <span class="comment">%The boundary markers</span>
</pre><p>Visualization</p><pre class="codeinput">hf=cFigure;
subplot(1,2,1); hold <span class="string">on</span>;
title(<span class="string">'Input boundaries'</span>,<span class="string">'FontSize'</span>,fontSize);
hp(1)=gpatch(Fb,V,Cb,<span class="string">'k'</span>,faceAlpha1);
hp(2)=plotV(V_regions,<span class="string">'r.'</span>,<span class="string">'MarkerSize'</span>,markerSize);
legend(hp,{<span class="string">'Input mesh'</span>,<span class="string">'Interior point(s)'</span>},<span class="string">'Location'</span>,<span class="string">'NorthWestOutside'</span>);
axisGeom(gca,fontSize); camlight <span class="string">headlight</span>;
colormap(cMap); icolorbar;

hs=subplot(1,2,2); hold <span class="string">on</span>;
title(<span class="string">'Tetrahedral mesh'</span>,<span class="string">'FontSize'</span>,fontSize);

<span class="comment">% Visualizing using |meshView|</span>
optionStruct.hFig=[hf,hs];
meshView(meshOutput,optionStruct);

axisGeom(gca,fontSize);
gdrawnow;
</pre><img width="100%" height="auto" vspace="5" hspace="5" src="HELP_runTetGen_03.jpg" alt=""> <h2 id="21">Example 4: Meshing a multi-region model</h2><p>Creating boundary surfaces</p><pre class="codeinput"><span class="comment">%Outer bunny</span>
[F1,V1]=stanford_bunny(<span class="string">'g'</span>); <span class="comment">%Bunny</span>
V1_mean=mean(V1,1);
V1=V1-V1_mean(ones(size(V1,1),1),:);

<span class="comment">%Inner bunny</span>
V2=V1/4;
V2(:,3)=V2(:,3)-35;
V2(:,2)=V2(:,2)-15;
V2(:,1)=V2(:,1)+10;

V3=V1/4;
V3(:,3)=V3(:,3)-10;
V3(:,2)=V3(:,2)+10;
V3(:,1)=V3(:,1)+40;

<span class="comment">%Joining surface sets</span>
[F,V,C]=joinElementSets({F1,F1,F1},{V1,V2,V3});
</pre><p>Find interior points</p><pre class="codeinput">[V_region1]=getInnerPoint({F1,F1,F1},{V1,V2,V3});
[V_region2]=getInnerPoint(F1,V2);
[V_region3]=getInnerPoint(F1,V3);
V_regions=[V_region1; V_region2; V_region3];

<span class="comment">%Define hole points</span>
V_holes=[];

<span class="comment">% Volume parameters</span>
[vol1]=tetVolMeanEst(F1,V1);
[vol2]=tetVolMeanEst(F1,V2);
[vol3]=tetVolMeanEst(F1,V3);

regionTetVolumes=[vol1 vol2 vol3]; <span class="comment">%Element volume settings</span>
stringOpt=<span class="string">'-pq1.2AaY'</span>; <span class="comment">%Tetgen options</span>
</pre><p>mesh using tet</p><pre class="codeinput"><span class="comment">%Create tetgen input structure</span>
inputStruct.stringOpt=stringOpt; <span class="comment">%Tetgen options</span>
inputStruct.Faces=F; <span class="comment">%Boundary faces</span>
inputStruct.Nodes=V; <span class="comment">%Nodes of boundary</span>
inputStruct.faceBoundaryMarker=C;
inputStruct.regionPoints=V_regions; <span class="comment">%Interior points for regions</span>
inputStruct.holePoints=V_holes; <span class="comment">%Interior points for holes</span>
inputStruct.regionA=regionTetVolumes; <span class="comment">%Desired tetrahedral volume for each region</span>

<span class="comment">% Mesh model using tetrahedral elements using tetGen</span>
[meshOutput]=runTetGen(inputStruct); <span class="comment">%Run tetGen</span>
</pre><pre class="codeoutput"> 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- TETGEN Tetrahedral meshing --- 27-Nov-2023 11:03:19
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- Writing SMESH file --- 27-Nov-2023 11:03:19
----&gt; Adding node field
----&gt; Adding facet field
----&gt; Adding holes specification
----&gt; Adding region specification
--- Done --- 27-Nov-2023 11:03:19
--- Running TetGen to mesh input boundary--- 27-Nov-2023 11:03:19
Opening /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.smesh.
Delaunizing vertices...
Delaunay seconds:  0.012558
Creating surface mesh ...
Surface mesh seconds:  0.004039
Recovering boundaries...
Boundary recovery seconds:  0.00768
Removing exterior tetrahedra ...
Spreading region attributes.
Exterior tets removal seconds:  0.002712
Recovering Delaunayness...
Delaunay recovery seconds:  0.006258
Refining mesh...
  6078 insertions, added 4879 points, 201347 tetrahedra in queue.
  2023 insertions, added 1455 points, 233749 tetrahedra in queue.
  2697 insertions, added 1889 points, 273453 tetrahedra in queue.
  3595 insertions, added 2282 points, 315106 tetrahedra in queue.
  4792 insertions, added 2396 points, 336371 tetrahedra in queue.
  6388 insertions, added 1906 points, 268161 tetrahedra in queue.
  8515 insertions, added 1250 points, 1796 tetrahedra in queue.
Refinement seconds:  0.273391
Smoothing vertices...
Mesh smoothing seconds:  0.48088
Improving mesh...
Mesh improvement seconds:  0.01455

Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.node.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.ele.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.face.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.edge.

Output seconds:  0.051165
Total running seconds:  0.853455

Statistics:

  Input points: 4560
  Input facets: 9108
  Input segments: 13662
  Input holes: 0
  Input regions: 3

  Mesh points: 21224
  Mesh tetrahedra: 126673
  Mesh faces: 254864
  Mesh faces on exterior boundary: 3036
  Mesh faces on input facets: 9108
  Mesh edges on input segments: 13662
  Steiner points inside domain: 16664

--- Done --- 27-Nov-2023 11:03:19
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- Importing TetGen files --- 27-Nov-2023 11:03:19
--- Done --- 27-Nov-2023 11:03:20
</pre><p>Access mesh output structure</p><pre class="codeinput">E=meshOutput.elements; <span class="comment">%The elements</span>
V=meshOutput.nodes; <span class="comment">%The vertices or nodes</span>
CE=meshOutput.elementMaterialID; <span class="comment">%Element material or region id</span>
Fb=meshOutput.facesBoundary; <span class="comment">%The boundary faces</span>
Cb=meshOutput.boundaryMarker; <span class="comment">%The boundary markers</span>
</pre><p>Visualization</p><pre class="codeinput">hf=cFigure;
subplot(1,2,1); hold <span class="string">on</span>;
title(<span class="string">'Input boundaries'</span>,<span class="string">'FontSize'</span>,fontSize);
hp(1)=gpatch(Fb,V,Cb,<span class="string">'k'</span>,faceAlpha1);
hp(2)=plotV(V_regions,<span class="string">'r.'</span>,<span class="string">'MarkerSize'</span>,markerSize);
legend(hp,{<span class="string">'Input mesh'</span>,<span class="string">'Interior point(s)'</span>},<span class="string">'Location'</span>,<span class="string">'NorthWestOutside'</span>);
axisGeom(gca,fontSize); camlight <span class="string">headlight</span>;
colormap(cMap); icolorbar;

hs=subplot(1,2,2); hold <span class="string">on</span>;
title(<span class="string">'Tetrahedral mesh'</span>,<span class="string">'FontSize'</span>,fontSize);

<span class="comment">% Visualizing using |meshView|</span>
optionStruct.hFig=[hf,hs];
meshView(meshOutput,optionStruct);

axisGeom(gca,fontSize);
gdrawnow;
</pre><img width="100%" height="auto" vspace="5" hspace="5" src="HELP_runTetGen_04.jpg" alt=""> <h2 id="27">Example 5: Meshing regions with holes</h2><p>Simulating a multiregion mesh containing a void</p><pre class="codeinput">[F1,V1]=parasaurolophus; <span class="comment">%A dino</span>

<span class="comment">%An internal region</span>
[F2,V2,~]=geoSphere(3,0.4);
V2(:,1)=2*V2(:,1)+0.6;
V2(:,3)=V2(:,3)+0.25;

<span class="comment">%An internal hole</span>
[F3,V3,~]=geoSphere(2,0.3);
V3(:,1)=V3(:,1)+0.6;
V3(:,3)=V3(:,3)+0.25;

<span class="comment">%Joining surface sets</span>
[F,V,C]=joinElementSets({F1,F2,F3},{V1,V2,V3});
</pre><p>Find interior points</p><pre class="codeinput">[V_region1]=getInnerPoint({F1,F2,F3},{V1,V2,V3});
[V_region2]=getInnerPoint(F2,V2);
[V_holes]=getInnerPoint(F3,V3);

V_regions=[V_region1; V_region2];

<span class="comment">% Volume parameters</span>
[vol1]=tetVolMeanEst(F1,V1);
[vol2]=tetVolMeanEst(F2,V2);

regionTetVolumes=[vol1 vol2]; <span class="comment">%Element volume settings</span>
stringOpt=<span class="string">'-pq1.2AaY'</span>; <span class="comment">%Tetgen options</span>
</pre><p>mesh using tet</p><pre class="codeinput"><span class="comment">%Create tetgen input structure</span>
inputStruct.stringOpt=stringOpt; <span class="comment">%Tetgen options</span>
inputStruct.Faces=F; <span class="comment">%Boundary faces</span>
inputStruct.Nodes=V; <span class="comment">%Nodes of boundary</span>
inputStruct.faceBoundaryMarker=C;
inputStruct.regionPoints=V_regions; <span class="comment">%Interior points for regions</span>
inputStruct.holePoints=V_holes; <span class="comment">%Interior points for holes</span>
inputStruct.regionA=regionTetVolumes; <span class="comment">%Desired tetrahedral volume for each region</span>

<span class="comment">% Mesh model using tetrahedral elements using tetGen</span>
[meshOutput]=runTetGen(inputStruct); <span class="comment">%Run tetGen</span>
</pre><pre class="codeoutput"> 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- TETGEN Tetrahedral meshing --- 27-Nov-2023 11:03:22
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- Writing SMESH file --- 27-Nov-2023 11:03:22
----&gt; Adding node field
----&gt; Adding facet field
----&gt; Adding holes specification
----&gt; Adding region specification
--- Done --- 27-Nov-2023 11:03:22
--- Running TetGen to mesh input boundary--- 27-Nov-2023 11:03:22
Opening /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.smesh.
Delaunizing vertices...
Delaunay seconds:  0.019816
Creating surface mesh ...
Surface mesh seconds:  0.002146
Recovering boundaries...
Boundary recovery seconds:  0.004565
Removing exterior tetrahedra ...
Spreading region attributes.
Exterior tets removal seconds:  0.002047
Recovering Delaunayness...
Delaunay recovery seconds:  0.004048
Refining mesh...
  3452 insertions, added 2075 points, 68090 tetrahedra in queue.
  1149 insertions, added 447 points, 75231 tetrahedra in queue.
  1532 insertions, added 441 points, 78109 tetrahedra in queue.
  2042 insertions, added 384 points, 71670 tetrahedra in queue.
  2722 insertions, added 263 points, 45257 tetrahedra in queue.
  3628 insertions, added 247 points, 2820 tetrahedra in queue.
  4836 insertions, added 313 points, 598 tetrahedra in queue.
Refinement seconds:  0.091261
Smoothing vertices...
Mesh smoothing seconds:  0.091693
Improving mesh...
Mesh improvement seconds:  0.004078

Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.node.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.ele.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.face.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.edge.

Output seconds:  0.014254
Total running seconds:  0.234057

Statistics:

  Input points: 2590
  Input facets: 5168
  Input segments: 7752
  Input holes: 1
  Input regions: 2

  Mesh points: 6887
  Mesh tetrahedra: 36644
  Mesh faces: 75232
  Mesh faces on exterior boundary: 3888
  Mesh faces on input facets: 5168
  Mesh edges on input segments: 7752
  Steiner points inside domain: 4297

--- Done --- 27-Nov-2023 11:03:23
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- Importing TetGen files --- 27-Nov-2023 11:03:23
--- Done --- 27-Nov-2023 11:03:23
</pre><p>Access mesh output structure</p><pre class="codeinput">E=meshOutput.elements; <span class="comment">%The elements</span>
V=meshOutput.nodes; <span class="comment">%The vertices or nodes</span>
CE=meshOutput.elementMaterialID; <span class="comment">%Element material or region id</span>
Fb=meshOutput.facesBoundary; <span class="comment">%The boundary faces</span>
Cb=meshOutput.boundaryMarker; <span class="comment">%The boundary markers</span>
</pre><p>Visualization</p><pre class="codeinput">hf=cFigure;
subplot(1,2,1); hold <span class="string">on</span>;
title(<span class="string">'Input boundaries'</span>,<span class="string">'FontSize'</span>,fontSize);
hp(1)=gpatch(Fb,V,Cb,<span class="string">'k'</span>,faceAlpha1);
hp(2)=plotV(V_regions,<span class="string">'r.'</span>,<span class="string">'MarkerSize'</span>,markerSize);
hp(3)=plotV(V_holes,<span class="string">'g.'</span>,<span class="string">'MarkerSize'</span>,markerSize);
legend(hp,{<span class="string">'Input mesh'</span>,<span class="string">'Interior point(s)'</span>,<span class="string">'Hole point(s)'</span>},<span class="string">'Location'</span>,<span class="string">'NorthWestOutside'</span>);
axisGeom(gca,fontSize); camlight <span class="string">headlight</span>;
colormap(cMap); icolorbar;

hs=subplot(1,2,2); hold <span class="string">on</span>;
title(<span class="string">'Tetrahedral mesh'</span>,<span class="string">'FontSize'</span>,fontSize);

<span class="comment">% Visualizing using |meshView|</span>
optionStruct.hFig=[hf,hs];
meshView(meshOutput,optionStruct);

axisGeom(gca,fontSize);
gdrawnow;
</pre><img width="100%" height="auto" vspace="5" hspace="5" src="HELP_runTetGen_05.jpg" alt=""> <h2 id="33">Example 6: Meshing from a quadrilateral input surface</h2><p>Build a quadrilateral surface</p><pre class="codeinput">boxDim =[12 2 3];
boxEl  =[12 2 3];
[F,V,C]=quadBox(boxDim,boxEl);

regionTetVolumes=tetVolMeanEst(F,V);
V_regions=mean(V,1);
stringOpt=<span class="string">'-pq1.2AaY'</span>; <span class="comment">%Tetgen options</span>
V_holes=[];
</pre><p>Mesh using TetGen</p><pre class="codeinput"><span class="comment">%Create tetgen input structure</span>
inputStruct.stringOpt=stringOpt; <span class="comment">%Tetgen options</span>
inputStruct.Faces=F; <span class="comment">%Boundary faces</span>
inputStruct.Nodes=V; <span class="comment">%Nodes of boundary</span>
inputStruct.faceBoundaryMarker=C;
inputStruct.regionPoints=V_regions; <span class="comment">%Interior points for regions</span>
inputStruct.holePoints=V_holes; <span class="comment">%Interior points for holes</span>
inputStruct.regionA=regionTetVolumes; <span class="comment">%Desired tetrahedral volume for each region</span>

<span class="comment">% Mesh model using tetrahedral elements using tetGen</span>
[meshOutput]=runTetGen(inputStruct); <span class="comment">%Run tetGen</span>
</pre><pre class="codeoutput"> 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- TETGEN Tetrahedral meshing --- 27-Nov-2023 11:03:25
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- Writing SMESH file --- 27-Nov-2023 11:03:25
----&gt; Adding node field
----&gt; Adding facet field
----&gt; Adding holes specification
----&gt; Adding region specification
--- Done --- 27-Nov-2023 11:03:25
--- Running TetGen to mesh input boundary--- 27-Nov-2023 11:03:25
Opening /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.smesh.
Delaunizing vertices...
Delaunay seconds:  0.00162
Creating surface mesh ...
Surface mesh seconds:  0.000295
Recovering boundaries...
Boundary recovery seconds:  0.001106
Removing exterior tetrahedra ...
Spreading region attributes.
Exterior tets removal seconds:  4.7e-05
Recovering Delaunayness...
Delaunay recovery seconds:  0.001016
Refining mesh...
  178 insertions, added 49 points, 1216 tetrahedra in queue.
  59 insertions, added 7 points, 999 tetrahedra in queue.
  78 insertions, added 2 points, 424 tetrahedra in queue.
  104 insertions, added 8 points, 168 tetrahedra in queue.
  139 insertions, added 9 points, 84 tetrahedra in queue.
Refinement seconds:  0.002885
Smoothing vertices...
Mesh smoothing seconds:  0.003805
Improving mesh...
Mesh improvement seconds:  9.9e-05

Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.node.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.ele.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.face.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.edge.

Output seconds:  0.000424
Total running seconds:  0.011347

Statistics:

  Input points: 134
  Input facets: 132
  Input segments: 264
  Input holes: 0
  Input regions: 1

  Mesh points: 217
  Mesh tetrahedra: 836
  Mesh faces: 1804
  Mesh faces on exterior boundary: 264
  Mesh faces on input facets: 264
  Mesh edges on input segments: 264
  Steiner points inside domain: 83

--- Done --- 27-Nov-2023 11:03:25
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- Importing TetGen files --- 27-Nov-2023 11:03:25
--- Done --- 27-Nov-2023 11:03:25
</pre><p>Access mesh output structure</p><pre class="codeinput">E=meshOutput.elements; <span class="comment">%The elements</span>
V=meshOutput.nodes; <span class="comment">%The vertices or nodes</span>
CE=meshOutput.elementMaterialID; <span class="comment">%Element material or region id</span>
Fb=meshOutput.facesBoundary; <span class="comment">%The boundary faces</span>
Cb=meshOutput.boundaryMarker; <span class="comment">%The boundary markers</span>
</pre><p>Visualization</p><pre class="codeinput">hf=cFigure;
subplot(1,2,1); hold <span class="string">on</span>;
title(<span class="string">'Input boundaries'</span>,<span class="string">'FontSize'</span>,fontSize);
hp(1)=gpatch(F,V,C,<span class="string">'k'</span>,faceAlpha1);
hp(2)=plotV(V_regions,<span class="string">'r.'</span>,<span class="string">'MarkerSize'</span>,markerSize);
legend(hp,{<span class="string">'Input mesh'</span>,<span class="string">'Interior point(s)'</span>},<span class="string">'Location'</span>,<span class="string">'NorthWestOutside'</span>);
axisGeom(gca,fontSize); camlight <span class="string">headlight</span>;
colormap(cMap); icolorbar;

hs=subplot(1,2,2); hold <span class="string">on</span>;
title(<span class="string">'Tetrahedral mesh'</span>,<span class="string">'FontSize'</span>,fontSize);

<span class="comment">% Visualizing using |meshView|</span>
optionStruct.hFig=[hf,hs];
meshView(meshOutput,optionStruct);

axisGeom(gca,fontSize);
gdrawnow;
</pre><pre class="codeoutput">Warning: Ignoring extra legend entries. 
</pre><img width="100%" height="auto" vspace="5" hspace="5" src="HELP_runTetGen_06.jpg" alt=""> <h2 id="37">Example 7: Specifying a sizing function to control local mesh density</h2><p>Build example geometry</p><pre class="codeinput">boxDim =[12 2 3];
boxEl  =[12 2 3];
[F,V,C]=quadBox(boxDim,boxEl);
V_input=V;
</pre><p>Defining a size function on the boundary nodes</p><pre class="codeinput"><span class="comment">%Get edge lengths and base minimum size on input edge lengths</span>
[edgeLengths]=patchEdgeLengths(F,V);
minEdgeSize=mean(edgeLengths)/5; <span class="comment">%The smallest element size</span>

n=5; <span class="comment">%The largest element edge length is n times minEdgeSize</span>
edgeSizeField=V(:,1);
edgeSizeField=edgeSizeField-min(edgeSizeField(:));
edgeSizeField=edgeSizeField./max(edgeSizeField(:));
edgeSizeField=(edgeSizeField*(n-1))+1; <span class="comment">%Range from 0-n depending on V(:,1) i.e. X-dir</span>
edgeSizeField=(edgeSizeField*minEdgeSize);

regionTetVolumes=tetVolMeanEst(F,V);
V_regions=mean(V,1);
stringOpt=<span class="string">'-pq1.2Aa'</span>; <span class="comment">%Tetgen options</span>
V_holes=[];
</pre><p>Mesh using TetGen</p><pre class="codeinput"><span class="comment">%Create tetgen input structure</span>
inputStruct.stringOpt=stringOpt; <span class="comment">%Tetgen options</span>
inputStruct.Faces=F; <span class="comment">%Boundary faces</span>
inputStruct.Nodes=V; <span class="comment">%Nodes of boundary</span>
inputStruct.faceBoundaryMarker=C;
inputStruct.regionPoints=V_regions; <span class="comment">%Interior points for regions</span>
inputStruct.holePoints=V_holes; <span class="comment">%Interior points for holes</span>
inputStruct.regionA=regionTetVolumes; <span class="comment">%Desired tetrahedral volume for each region</span>
inputStruct.sizeData=edgeSizeField; <span class="comment">%The size data</span>

<span class="comment">% Mesh model using tetrahedral elements using tetGen</span>
[meshOutput]=runTetGen(inputStruct); <span class="comment">%Run tetGen</span>
</pre><pre class="codeoutput"> 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- TETGEN Tetrahedral meshing --- 27-Nov-2023 11:03:27
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- Writing SMESH file --- 27-Nov-2023 11:03:27
----&gt; Adding node field
----&gt; Adding facet field
----&gt; Adding holes specification
----&gt; Adding region specification
--- Done --- 27-Nov-2023 11:03:27
--- Writing MTR file --- 27-Nov-2023 11:03:27
--- Running TetGen to mesh initial Delaunay tesselation using sizing function--- 27-Nov-2023 11:03:27
Opening /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.smesh.
Opening /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.mtr.
  Cannot access file /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.b.node.
Delaunizing vertices...
Delaunay seconds:  0.001552
Creating surface mesh ...
Surface mesh seconds:  0.000299
Recovering boundaries...
Boundary recovery seconds:  0.001048
Removing exterior tetrahedra ...
Spreading region attributes.
Exterior tets removal seconds:  6.4e-05
Mesh coarsening ...
Mesh coarsening seconds:  1e-06
Recovering Delaunayness...
Delaunay recovery seconds:  0.000945
Refining mesh...
  178 insertions, added 111 points, 2184 tetrahedra in queue.
  59 insertions, added 38 points, 2770 tetrahedra in queue.
  78 insertions, added 49 points, 3452 tetrahedra in queue.
  104 insertions, added 73 points, 4701 tetrahedra in queue.
  139 insertions, added 92 points, 6154 tetrahedra in queue.
  185 insertions, added 124 points, 8181 tetrahedra in queue.
  247 insertions, added 178 points, 11206 tetrahedra in queue.
  329 insertions, added 228 points, 14867 tetrahedra in queue.
  439 insertions, added 294 points, 16828 tetrahedra in queue.
Refinement seconds:  0.014634
Smoothing vertices...
Mesh smoothing seconds:  0.021465
Improving mesh...
Mesh improvement seconds:  0.000687

Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.node.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.ele.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.face.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.edge.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.mtr.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.p2t.

Output seconds:  0.002907
Total running seconds:  0.043644

Statistics:

  Input points: 134
  Input facets: 132
  Input segments: 68
  Input holes: 0
  Input regions: 1

  Mesh points: 1406
  Mesh tetrahedra: 6194
  Mesh faces: 13133
  Mesh faces on exterior boundary: 1490
  Mesh faces on input facets: 1490
  Mesh edges on input segments: 131
  Steiner points on input facets:  550
  Steiner points on input segments:  63
  Steiner points inside domain: 659

--- Done --- 27-Nov-2023 11:03:27
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- Importing TetGen files --- 27-Nov-2023 11:03:27
--- Done --- 27-Nov-2023 11:03:27
</pre><p>Access mesh output structure</p><pre class="codeinput">E=meshOutput.elements; <span class="comment">%The elements</span>
V=meshOutput.nodes; <span class="comment">%The vertices or nodes</span>
CE=meshOutput.elementMaterialID; <span class="comment">%Element material or region id</span>
Fb=meshOutput.facesBoundary; <span class="comment">%The boundary faces</span>
Cb=meshOutput.boundaryMarker; <span class="comment">%The boundary markers</span>
</pre><p>Visualization</p><pre class="codeinput">hf=cFigure;
subplot(1,2,1); hold <span class="string">on</span>;
title(<span class="string">'Input boundaries'</span>,<span class="string">'FontSize'</span>,fontSize);
hp(1)=gpatch(F,V,<span class="string">'kw'</span>,<span class="string">'none'</span>,faceAlpha1);
hp(2)=plotV(V_regions,<span class="string">'r.'</span>,<span class="string">'MarkerSize'</span>,markerSize);
hp(3)=scatterV(V_input,75,edgeSizeField,<span class="string">'fill'</span>);
legend(hp,{<span class="string">'Input mesh'</span>,<span class="string">'Interior point(s)'</span>,<span class="string">'Sizing function points'</span>},<span class="string">'Location'</span>,<span class="string">'NorthWestOutside'</span>);
axisGeom(gca,fontSize); camlight <span class="string">headlight</span>;
colormap(cMap); colorbar;
hs=subplot(1,2,2); hold <span class="string">on</span>;
title(<span class="string">'Tetrahedral mesh'</span>,<span class="string">'FontSize'</span>,fontSize);

<span class="comment">% Visualizing using |meshView|</span>
optionStruct.hFig=[hf,hs];
meshView(meshOutput,optionStruct);

axisGeom(gca,fontSize);
gdrawnow;

clear <span class="string">hp</span>;
</pre><img width="100%" height="auto" vspace="5" hspace="5" src="HELP_runTetGen_07.jpg" alt=""> <h2 id="43">Example 8: Meshing of topology with holes and complex regions</h2><p>Simulating nested spheres with a hollow core and "tunnel" to outside</p><pre class="codeinput">w=0.25;
r=0.1;

[Fs1,Vs1]=geoSphere(4,1);
[Fs2,Vs2]=geoSphere(4,1-w);
[Fs3,Vs3]=geoSphere(4,1-2*w);

R=sqrt(sum(Vs1(:,[1 2]).^2,2));
logicCropVertices=R&lt;=(r+mean(patchEdgeLengths(Fs1,Vs1))) &amp; Vs1(:,3)&gt;0;
logicCropFaces=any(logicCropVertices(Fs1),2);
logicCropFaces=triSurfLogicSharpFix(Fs1,logicCropFaces);

Fs1=Fs1(~logicCropFaces,:);
Fs2=Fs2(~logicCropFaces,:);
Fs3=Fs3(~logicCropFaces,:);

Eb=patchBoundary(Fs1);
indB=edgeListToCurve(Eb);
indB=indB(1:end-1);

cPar.closeLoopOpt=1;
cPar.patchType=<span class="string">'tri_slash'</span>;
[Fs4,Vs4]=polyLoftLinear(Vs3(indB,:),Vs2(indB,:),cPar);
[Fs5,Vs5]=polyLoftLinear(Vs2(indB,:),Vs1(indB,:),cPar);

[F,V,C]=joinElementSets({Fs1,Fs2,Fs3,Fs4,Fs5},{Vs1,Vs2,Vs3,Vs4,Vs5});
[F,V]=mergeVertices(F,V);
[F,V]=patchCleanUnused(F,V);

logicRegion1=ismember(C,[1 2 max(C(:))]);
logicRegion2=ismember(C,[2 3 4]);

V_inner1=getInnerPoint(F(logicRegion1,:),V);
V_inner2=getInnerPoint(F(logicRegion2,:),V);

V_regions=[V_inner1; V_inner2];

regionTetVolumes=tetVolMeanEst(F,V);
stringOpt=<span class="string">'-pq1.2AaY'</span>; <span class="comment">%Tetgen options</span>
V_holes=[];
</pre><p>Mesh using TetGen</p><pre class="codeinput"><span class="comment">%Create tetgen input structure</span>
inputStruct.stringOpt=stringOpt; <span class="comment">%Tetgen options</span>
inputStruct.Faces=F; <span class="comment">%Boundary faces</span>
inputStruct.Nodes=V; <span class="comment">%Nodes of boundary</span>
inputStruct.faceBoundaryMarker=C;
inputStruct.regionPoints=V_regions; <span class="comment">%Interior points for regions</span>
inputStruct.holePoints=V_holes; <span class="comment">%Interior points for holes</span>
inputStruct.regionA=regionTetVolumes*ones(size(V_regions,1),1); <span class="comment">%Desired tetrahedral volume for each region</span>

<span class="comment">% Mesh model using tetrahedral elements using tetGen</span>
[meshOutput]=runTetGen(inputStruct); <span class="comment">%Run tetGen</span>
</pre><pre class="codeoutput"> 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- TETGEN Tetrahedral meshing --- 27-Nov-2023 11:03:29
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- Writing SMESH file --- 27-Nov-2023 11:03:29
----&gt; Adding node field
----&gt; Adding facet field
----&gt; Adding holes specification
----&gt; Adding region specification
--- Done --- 27-Nov-2023 11:03:30
--- Writing MTR file --- 27-Nov-2023 11:03:30
--- Running TetGen to mesh initial Delaunay tesselation using sizing function--- 27-Nov-2023 11:03:30
Opening /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.smesh.
Opening /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.mtr.
  !! Point numbers are not equal. Ignored.
  Cannot access file /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.b.node.
Delaunizing vertices...
Delaunay seconds:  0.389077
Creating surface mesh ...
Surface mesh seconds:  0.006836
Recovering boundaries...
Boundary recovery seconds:  0.02056
Removing exterior tetrahedra ...
Spreading region attributes.
Exterior tets removal seconds:  0.004188
Mesh coarsening ...
Mesh coarsening seconds:  3.1e-05
Recovering Delaunayness...
Delaunay recovery seconds:  0.129384
Refining mesh...
  10361 insertions, added 9297 points, 334556 tetrahedra in queue.
  3450 insertions, added 2824 points, 398524 tetrahedra in queue.
  4599 insertions, added 3745 points, 479417 tetrahedra in queue.
  6130 insertions, added 4698 points, 575136 tetrahedra in queue.
  8171 insertions, added 5689 points, 675937 tetrahedra in queue.
  10892 insertions, added 5922 points, 715058 tetrahedra in queue.
  14519 insertions, added 4609 points, 355526 tetrahedra in queue.
  19354 insertions, added 2248 points, 22150 tetrahedra in queue.
Refinement seconds:  0.711101
Smoothing vertices...
Mesh smoothing seconds:  1.615
Improving mesh...
Mesh improvement seconds:  0.032621

Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.node.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.ele.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.face.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.edge.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.mtr.
Writing /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.1.p2t.

Output seconds:  0.112968
Total running seconds:  3.02214

Statistics:

  Input points: 7773
  Input facets: 15558
  Input segments: 23328
  Input holes: 0
  Input regions: 2

  Mesh points: 47291
  Mesh tetrahedra: 275949
  Mesh faces: 557144
  Mesh faces on exterior boundary: 10492
  Mesh faces on input facets: 15558
  Mesh edges on input segments: 23328
  Steiner points inside domain: 39518

--- Done --- 27-Nov-2023 11:03:33
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- Importing TetGen files --- 27-Nov-2023 11:03:33
--- Done --- 27-Nov-2023 11:03:33
</pre><p>Access mesh output structure</p><pre class="codeinput">E=meshOutput.elements; <span class="comment">%The elements</span>
V=meshOutput.nodes; <span class="comment">%The vertices or nodes</span>
CE=meshOutput.elementMaterialID; <span class="comment">%Element material or region id</span>
Fb=meshOutput.facesBoundary; <span class="comment">%The boundary faces</span>
Cb=meshOutput.boundaryMarker; <span class="comment">%The boundary markers</span>
</pre><p>Visualization</p><pre class="codeinput">hf=cFigure;
subplot(1,2,1); hold <span class="string">on</span>;
title(<span class="string">'Input boundaries'</span>,<span class="string">'FontSize'</span>,fontSize);
hp(1)=gpatch(F,V,<span class="string">'kw'</span>,<span class="string">'none'</span>,faceAlpha1);
hp(2)=plotV(V_regions,<span class="string">'r.'</span>,<span class="string">'MarkerSize'</span>,markerSize);
legend(hp,{<span class="string">'Input mesh'</span>,<span class="string">'Interior point(s)'</span>},<span class="string">'Location'</span>,<span class="string">'NorthWestOutside'</span>);
axisGeom(gca,fontSize); camlight <span class="string">headlight</span>;
colormap(cMap); colorbar;
hs=subplot(1,2,2); hold <span class="string">on</span>;
title(<span class="string">'Tetrahedral mesh'</span>,<span class="string">'FontSize'</span>,fontSize);

<span class="comment">% Visualizing using |meshView|</span>
optionStruct.hFig=[hf,hs];
meshView(meshOutput,optionStruct);

axisGeom(gca,fontSize);
gdrawnow;

clear <span class="string">hp</span>;
</pre><img width="100%" height="auto" vspace="5" hspace="5" src="HELP_runTetGen_08.jpg" alt=""> <h2 id="47">Example 9: Meshing 10-node (i.e. quadratic) tetrahedral elements</h2><pre class="codeinput"><span class="comment">% Building spherical surface models</span>
[F,V,~]=geoSphere(2,1);
C=ones(size(F,1),1);
V_regions=[0 0 0];
V_holes=[];
regionTetVolumes=tetVolMeanEst(F,V);
stringOpt=<span class="string">'-pq1.2AaYQ'</span>;
</pre><p>Mesh using TetGen</p><pre class="codeinput"><span class="comment">%Create tetgen input structure</span>
inputStruct.stringOpt=stringOpt; <span class="comment">%Tetgen options</span>
inputStruct.Faces=F; <span class="comment">%Boundary faces</span>
inputStruct.Nodes=V; <span class="comment">%Nodes of boundary</span>
inputStruct.faceBoundaryMarker=C;
inputStruct.regionPoints=V_regions; <span class="comment">%Interior points for regions</span>
inputStruct.holePoints=V_holes; <span class="comment">%Interior points for holes</span>
inputStruct.regionA=regionTetVolumes; <span class="comment">%Desired tetrahedral volume for each region</span>
inputStruct.tetType=<span class="string">'tet10'</span>; <span class="comment">%Set desired element type</span>

<span class="comment">% Mesh model using tetrahedral elements using tetGen</span>
[meshOutput]=runTetGen(inputStruct); <span class="comment">%Run tetGen</span>
</pre><pre class="codeoutput"> 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- TETGEN Tetrahedral meshing --- 27-Nov-2023 11:03:36
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- Writing SMESH file --- 27-Nov-2023 11:03:36
----&gt; Adding node field
----&gt; Adding facet field
----&gt; Adding holes specification
----&gt; Adding region specification
--- Done --- 27-Nov-2023 11:03:36
--- Writing MTR file --- 27-Nov-2023 11:03:36
--- Running TetGen to mesh initial Delaunay tesselation using sizing function--- 27-Nov-2023 11:03:36
Opening /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.smesh.
Opening /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.mtr.
  !! Point numbers are not equal. Ignored.
  Cannot access file /home/kevin/DATA/Code/matlab/GIBBON/data/temp/temp.b.node.
--- Done --- 27-Nov-2023 11:03:36
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
--- Importing TetGen files --- 27-Nov-2023 11:03:36
--- Done --- 27-Nov-2023 11:03:36
</pre><p>Access mesh output structure</p><pre class="codeinput">E=meshOutput.elements; <span class="comment">%The elements</span>
V=meshOutput.nodes; <span class="comment">%The vertices or nodes</span>
CE=meshOutput.elementMaterialID; <span class="comment">%Element material or region id</span>
Fb=meshOutput.facesBoundary; <span class="comment">%The boundary faces</span>
Cb=meshOutput.boundaryMarker; <span class="comment">%The boundary markers</span>
</pre><p>Visualization</p><pre class="codeinput"><span class="comment">%Selecting half of the model to see interior</span>
Y=V(:,2); YE=mean(Y(E),2);
logicCutView=YE&gt;mean(Y);
[Fs,Cs]=element2patch(E(logicCutView,:),CE(logicCutView),<span class="string">'tet10'</span>);

hf=cFigure;
subplot(1,2,1); hold <span class="string">on</span>;
title(<span class="string">'Input boundaries'</span>,<span class="string">'FontSize'</span>,fontSize);
hp(1)=gpatch(F,V,C,<span class="string">'k'</span>,faceAlpha1);
hp(2)=plotV(V_regions,<span class="string">'r.'</span>,<span class="string">'MarkerSize'</span>,markerSize);
legend(hp,{<span class="string">'Input mesh'</span>,<span class="string">'Interior point(s)'</span>},<span class="string">'Location'</span>,<span class="string">'NorthWestOutside'</span>);
axisGeom(gca,fontSize); camlight <span class="string">headlight</span>;
colormap(cMap); icolorbar;

hs=subplot(1,2,2); hold <span class="string">on</span>;
title(<span class="string">'Tetrahedral mesh'</span>,<span class="string">'FontSize'</span>,fontSize);

title(<span class="string">'Cut view of tetrahedral mesh model'</span>,<span class="string">'FontSize'</span>,fontSize);
gpatch(Fb,V,0.5*ones(1,3),<span class="string">'none'</span>,faceAlpha1);
gpatch(Fs,V,Cs,<span class="string">'k'</span>,faceAlpha2);
<span class="comment">% patchNormPlot(Fs,V);</span>

plotV(V(unique(Fs(:)),:),<span class="string">'k.'</span>,<span class="string">'MarkerSize'</span>,markerSize);
camlight <span class="string">headlight</span>;
axisGeom(gca,fontSize);
colormap(cMap);
gdrawnow;
</pre><img width="100%" height="auto" vspace="5" hspace="5" src="HELP_runTetGen_09.jpg" alt=""> <p><img vspace="5" hspace="5" src="gibbVerySmall.gif" alt=""> </p><p><i><b>GIBBON</b></i> <a href="www.gibboncode.org">www.gibboncode.org</a></p><p><i>Kevin Mattheus Moerman</i>, <a href="gibbon.toolbox@gmail.com">gibbon.toolbox@gmail.com</a></p><p><i><b>GIBBON footer text</b></i></p><p>License: <a href="https://github.com/gibbonCode/GIBBON/blob/master/LICENSE">https://github.com/gibbonCode/GIBBON/blob/master/LICENSE</a></p><p>GIBBON: The Geometry and Image-based Bioengineering add-On. A toolbox for image segmentation, image-based modeling, meshing, and finite element analysis.</p><p>Copyright (C) 2006-2023 Kevin Mattheus Moerman and the GIBBON contributors</p><p>This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.</p><p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.</p><p>You should have received a copy of the GNU General Public License along with this program.  If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.</p><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2023a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% runTetGen
% Below is a demonstration of the features of the |runTetGen| function

%% Syntax
% |[meshOutput]=runTetGen(inputStruct);|

%% Description
% This function creates a temporary .smesh file which it passes to TETGEN 
% (<http://wias-berlin.de/software/tetgen/>) for tetrahedral meshing. The
% input structure should contain the following fields: 
% 
% smeshStruct.stringOpt=stringOpt;
% Where stringOpt should contain a strin composed of valid TETGEN command
% line switches (e.g. '-pq1.2VAaY'). See info below and the TETGEN manual.
%
% smeshStruct.Faces=F; 
% Where F is an array for all the model (triangular) faces
%
% smeshStruct.Nodes=V; 
% Where V is the array containing the nodal coordinates
%
% smeshStruct.holePoints=V_holes;
% Where V_holes describes a point (not part of V) that lies inside a
% prescribed hole inside the mesh. If V_holes=[] no holes are defined. 
%
% smeshStruct.faceBoundaryMarker=faceBoundaryMarker; 
% Where faceBoundaryMarker defines a label for each face denoting its
% membership to a particular boundary (e.g. all outer faces could have the
% same boundary label while an internal set of faces defining a hole has a
% different label). 
%
% smeshStruct.regionPoints=V_regions;
% Where similarly to V_holes the array V_regions defines points (not part
% of V) that lie inside a specific region (e.g. a material can be contained
% within another material and this allows you to specify multiple materials
% with different mesh densities and output labels).
%
% smeshStruct.regionA=regionA;
% Where regionA is a vector defining the A specification (volume) for the
% corrensponding regions (as defined in V_regions)
%
% Optional parameters: 
%
% smeshStruct.minRegionMarker=2; %Minimum region marker
% Arbitrary region marker label. Regions are labeled minRegionMarker:1:...
% for all regions. 
%
% smeshStruct.smeshName=smeshName; 
% Where smeshName is the file name for the input .smesh file. Only .smesh
% files are currently supported as input files. This function generates the
% .smesh file using the |writeBasicSmesh| function
%
%
% Below is a list of command line switches from the user manual:
% 
% -p Tetrahedralizes a piecewise linear complex (PLC).
% -Y Preserves the input surface mesh (does not modify it).
% -r Reconstructs a previously generated mesh.
% -q Refines mesh (to improve mesh quality).
% -R Mesh coarsening (to reduce the mesh elements).
% -A Assigns attributes to tetrahedra in different regions.
% -a Applies a maximum tetrahedron volume constraint.
% -m Applies a mesh sizing function.
% -i Inserts a list of additional points.
% -O Specifies the level of mesh optimization.
% -S Specifies maximum number of added points.
% -T Sets a tolerance for coplanar test (default 10?8).
% -X Suppresses use of exact arithmetic.
% -M No merge of coplanar facets or very close vertices.
% -w Generates weighted Delaunay (regular) triangulation.
% -c Retains the convex hull of the PLC.
% -d Detects self-intersections of facets of the PLC.
% -z Numbers all output items starting from zero.
% -f Outputs all faces to .face file.
% -e Outputs all edges to .edge file.
% -n Outputs tetrahedra neighbors to .neigh file.
% -v Outputs Voronoi diagram to files.
% -g Outputs mesh to .mesh file for viewing by Medit.
% -k Outputs mesh to .vtk file for viewing by Paraview.
% -J No jettison of unused vertices from output .node file.
% -B Suppresses output of boundary information.
% -N Suppresses output of .node file.
% -E Suppresses output of .ele file.
% -F Suppresses output of .face and .edge file.
% -I Suppresses mesh iteration numbers.
% -C Checks the consistency of the final mesh.
% -Q Quiet: No terminal output except errors.
% -V Verbose: Detailed information, more terminal output.
% -h Help: A brief instruction for using TetGen.
%
% See the TETGEN manual for more information.

%% Examples

%%
clear; close all; clc;

%%
% Plot settings
fontSize=15;
faceAlpha1=0.3;
faceAlpha2=1;
cMap=gjet(4); 
patchColor=cMap(1,:);
markerSize=25; 

%% Example 1: Meshing a model with a single region

%%
% Creating geometry 
[F,V]=stanford_bunny('g'); %Bunny

C=ones(size(F,1),1); %Face boundary markers (aka face colors)
V_regions=getInnerPoint(F,V); %Define region points
V_holes=[]; %Define hole points
[regionTetVolumes]=tetVolMeanEst(F,V); %Volume estimate for regular tets
stringOpt='-pq1.2AaY'; %Options for tetgen

%%
% Mesh using TetGen

%Create tetgen input structure
inputStruct.stringOpt=stringOpt; %Tetgen options
inputStruct.Faces=F; %Boundary faces
inputStruct.Nodes=V; %Nodes of boundary
inputStruct.faceBoundaryMarker=C; 
inputStruct.regionPoints=V_regions; %Interior points for regions
inputStruct.holePoints=V_holes; %Interior points for holes
inputStruct.regionA=regionTetVolumes; %Desired tetrahedral volume for each region

% Mesh model using tetrahedral elements using tetGen 
[meshOutput]=runTetGen(inputStruct); %Run tetGen 

%% 
% Access mesh output structure

E=meshOutput.elements; %The elements
V=meshOutput.nodes; %The vertices or nodes
CE=meshOutput.elementMaterialID; %Element material or region id
Fb=meshOutput.facesBoundary; %The boundary faces
Cb=meshOutput.boundaryMarker; %The boundary markers

%%
% Visualization

hf=cFigure; 
subplot(1,2,1); hold on;
title('Input boundaries','FontSize',fontSize);
hp(1)=gpatch(Fb,V,Cb,'k',faceAlpha1);
hp(2)=plotV(V_regions,'r.','MarkerSize',markerSize);
legend(hp,{'Input mesh','Interior point(s)'},'Location','NorthWestOutside');
axisGeom(gca,fontSize); camlight headlight;
colormap(cMap); icolorbar;

hs=subplot(1,2,2); hold on;
title('Tetrahedral mesh','FontSize',fontSize);

% Visualizing using |meshView|
optionStruct.hFig=[hf,hs];
meshView(meshOutput,optionStruct);

axisGeom(gca,fontSize); 
gdrawnow;

%% Example 2: Meshing imported geometry

%%
% Import an STL model
defaultFolder = fileparts(fileparts(mfilename('fullpath')));
pathName=fullfile(defaultFolder,'data','STL'); 
fileName=fullfile(pathName,'femur.stl'); 
[stlStruct] = import_STL(fileName);

F=stlStruct.solidFaces{1};
V=stlStruct.solidVertices{1};

% Merging nodes (nodes are not merged in stl)
[F,V]=mergeVertices(F,V);

C=ones(size(F,1),1); %Face boundary markers (aka face colors)
V_regions=getInnerPoint(F,V); %Define region points
V_holes=[]; %Define hole points
[regionTetVolumes]=tetVolMeanEst(F,V); %Volume estimate for regular tets
stringOpt='-pq1.2AaY'; %Options for tetgen

%%
% Mesh using TetGen

%Create tetgen input structure
inputStruct.stringOpt=stringOpt; %Tetgen options
inputStruct.Faces=F; %Boundary faces
inputStruct.Nodes=V; %Nodes of boundary
inputStruct.faceBoundaryMarker=C; 
inputStruct.regionPoints=V_regions; %Interior points for regions
inputStruct.holePoints=V_holes; %Interior points for holes
inputStruct.regionA=regionTetVolumes; %Desired tetrahedral volume for each region

% Mesh model using tetrahedral elements using tetGen 
[meshOutput]=runTetGen(inputStruct); %Run tetGen 

%% 
% Access mesh output structure

E=meshOutput.elements; %The elements
V=meshOutput.nodes; %The vertices or nodes
CE=meshOutput.elementMaterialID; %Element material or region id
Fb=meshOutput.facesBoundary; %The boundary faces
Cb=meshOutput.boundaryMarker; %The boundary markers

%%
% Visualization

hf=cFigure; 
subplot(1,2,1); hold on;
title('Input boundaries','FontSize',fontSize);
hp(1)=gpatch(Fb,V,Cb,'k',faceAlpha1);
hp(2)=plotV(V_regions,'r.','MarkerSize',markerSize);
legend(hp,{'Input mesh','Interior point(s)'},'Location','NorthWestOutside');
axisGeom(gca,fontSize); camlight headlight;
colormap(cMap); icolorbar;

hs=subplot(1,2,2); hold on;
title('Tetrahedral mesh','FontSize',fontSize);

% Visualizing using |meshView|
optionStruct.hFig=[hf,hs];
meshView(meshOutput,optionStruct);

axisGeom(gca,fontSize); 
gdrawnow;

%% Example 3: Meshing a two-region model

%%
% Create example geometry, here a torus containing a smaller torus

% An example surface
r=2; %Sphere radius
rc=3; %Central radius
nr=20;
nc=30;
ptype='tri';
[F1,V1]=patchTorus(r,nr,rc,nc,ptype);

r=1; %Sphere radius
rc=3; %Central radius
nr=15;
nc=25;
ptype='tri';
[F2,V2]=patchTorus(r,nr,rc,nc,ptype);

[F,V,C]=joinElementSets({F1 F2},{V1 V2}); %Join sets

[V_region1]=getInnerPoint(F(C==2,:),V); %First interior point
[V_region2]=getInnerPoint({F1,F2},{V1,V2}); %Second interior point
V_regions=[V_region1; V_region2]; %Collect region points
V_holes=[]; %Define hole points
[regionTetVolume1]=tetVolMeanEst(F1,V1); %Volume estimate for regular tets
[regionTetVolume2]=tetVolMeanEst(F2,V2); %Volume estimate for regular tets
regionTetVolumes=[regionTetVolume1 regionTetVolume2];
stringOpt='-pq1.2AaY'; %Tetgen options

%%
% mesh using tet
%Create tetgen input structure
inputStruct.stringOpt=stringOpt; %Tetgen options
inputStruct.Faces=F; %Boundary faces
inputStruct.Nodes=V; %Nodes of boundary
inputStruct.faceBoundaryMarker=C; 
inputStruct.regionPoints=V_regions; %Interior points for regions
inputStruct.holePoints=V_holes; %Interior points for holes
inputStruct.regionA=regionTetVolumes; %Desired tetrahedral volume for each region

% Mesh model using tetrahedral elements using tetGen 
[meshOutput]=runTetGen(inputStruct); %Run tetGen 

%% 
% Access mesh output structure

E=meshOutput.elements; %The elements
V=meshOutput.nodes; %The vertices or nodes
CE=meshOutput.elementMaterialID; %Element material or region id
Fb=meshOutput.facesBoundary; %The boundary faces
Cb=meshOutput.boundaryMarker; %The boundary markers

%%
% Visualization

hf=cFigure; 
subplot(1,2,1); hold on;
title('Input boundaries','FontSize',fontSize);
hp(1)=gpatch(Fb,V,Cb,'k',faceAlpha1);
hp(2)=plotV(V_regions,'r.','MarkerSize',markerSize);
legend(hp,{'Input mesh','Interior point(s)'},'Location','NorthWestOutside');
axisGeom(gca,fontSize); camlight headlight;
colormap(cMap); icolorbar;

hs=subplot(1,2,2); hold on;
title('Tetrahedral mesh','FontSize',fontSize);

% Visualizing using |meshView|
optionStruct.hFig=[hf,hs];
meshView(meshOutput,optionStruct);

axisGeom(gca,fontSize); 
gdrawnow;

%% Example 4: Meshing a multi-region model

%%
% Creating boundary surfaces

%Outer bunny
[F1,V1]=stanford_bunny('g'); %Bunny
V1_mean=mean(V1,1);
V1=V1-V1_mean(ones(size(V1,1),1),:);

%Inner bunny
V2=V1/4;
V2(:,3)=V2(:,3)-35;
V2(:,2)=V2(:,2)-15;
V2(:,1)=V2(:,1)+10;

V3=V1/4;
V3(:,3)=V3(:,3)-10;
V3(:,2)=V3(:,2)+10;
V3(:,1)=V3(:,1)+40;

%Joining surface sets
[F,V,C]=joinElementSets({F1,F1,F1},{V1,V2,V3});

%%
% Find interior points
[V_region1]=getInnerPoint({F1,F1,F1},{V1,V2,V3}); 
[V_region2]=getInnerPoint(F1,V2); 
[V_region3]=getInnerPoint(F1,V3); 
V_regions=[V_region1; V_region2; V_region3];

%Define hole points
V_holes=[]; 

% Volume parameters
[vol1]=tetVolMeanEst(F1,V1);
[vol2]=tetVolMeanEst(F1,V2);
[vol3]=tetVolMeanEst(F1,V3);

regionTetVolumes=[vol1 vol2 vol3]; %Element volume settings
stringOpt='-pq1.2AaY'; %Tetgen options

%%
% mesh using tet
%Create tetgen input structure
inputStruct.stringOpt=stringOpt; %Tetgen options
inputStruct.Faces=F; %Boundary faces
inputStruct.Nodes=V; %Nodes of boundary
inputStruct.faceBoundaryMarker=C; 
inputStruct.regionPoints=V_regions; %Interior points for regions
inputStruct.holePoints=V_holes; %Interior points for holes
inputStruct.regionA=regionTetVolumes; %Desired tetrahedral volume for each region

% Mesh model using tetrahedral elements using tetGen 
[meshOutput]=runTetGen(inputStruct); %Run tetGen 

%% 
% Access mesh output structure

E=meshOutput.elements; %The elements
V=meshOutput.nodes; %The vertices or nodes
CE=meshOutput.elementMaterialID; %Element material or region id
Fb=meshOutput.facesBoundary; %The boundary faces
Cb=meshOutput.boundaryMarker; %The boundary markers

%%
% Visualization

hf=cFigure; 
subplot(1,2,1); hold on;
title('Input boundaries','FontSize',fontSize);
hp(1)=gpatch(Fb,V,Cb,'k',faceAlpha1);
hp(2)=plotV(V_regions,'r.','MarkerSize',markerSize);
legend(hp,{'Input mesh','Interior point(s)'},'Location','NorthWestOutside');
axisGeom(gca,fontSize); camlight headlight;
colormap(cMap); icolorbar;

hs=subplot(1,2,2); hold on;
title('Tetrahedral mesh','FontSize',fontSize);

% Visualizing using |meshView|
optionStruct.hFig=[hf,hs];
meshView(meshOutput,optionStruct);

axisGeom(gca,fontSize); 
gdrawnow;

%% Example 5: Meshing regions with holes

%%
% Simulating a multiregion mesh containing a void

[F1,V1]=parasaurolophus; %A dino 

%An internal region
[F2,V2,~]=geoSphere(3,0.4); 
V2(:,1)=2*V2(:,1)+0.6;
V2(:,3)=V2(:,3)+0.25;

%An internal hole
[F3,V3,~]=geoSphere(2,0.3); 
V3(:,1)=V3(:,1)+0.6;
V3(:,3)=V3(:,3)+0.25;

%Joining surface sets
[F,V,C]=joinElementSets({F1,F2,F3},{V1,V2,V3});

%%
% Find interior points

[V_region1]=getInnerPoint({F1,F2,F3},{V1,V2,V3}); 
[V_region2]=getInnerPoint(F2,V2); 
[V_holes]=getInnerPoint(F3,V3); 

V_regions=[V_region1; V_region2];

% Volume parameters
[vol1]=tetVolMeanEst(F1,V1);
[vol2]=tetVolMeanEst(F2,V2);

regionTetVolumes=[vol1 vol2]; %Element volume settings
stringOpt='-pq1.2AaY'; %Tetgen options

%%
% mesh using tet
%Create tetgen input structure
inputStruct.stringOpt=stringOpt; %Tetgen options
inputStruct.Faces=F; %Boundary faces
inputStruct.Nodes=V; %Nodes of boundary
inputStruct.faceBoundaryMarker=C; 
inputStruct.regionPoints=V_regions; %Interior points for regions
inputStruct.holePoints=V_holes; %Interior points for holes
inputStruct.regionA=regionTetVolumes; %Desired tetrahedral volume for each region

% Mesh model using tetrahedral elements using tetGen 
[meshOutput]=runTetGen(inputStruct); %Run tetGen 

%% 
% Access mesh output structure

E=meshOutput.elements; %The elements
V=meshOutput.nodes; %The vertices or nodes
CE=meshOutput.elementMaterialID; %Element material or region id
Fb=meshOutput.facesBoundary; %The boundary faces
Cb=meshOutput.boundaryMarker; %The boundary markers

%%
% Visualization

hf=cFigure; 
subplot(1,2,1); hold on;
title('Input boundaries','FontSize',fontSize);
hp(1)=gpatch(Fb,V,Cb,'k',faceAlpha1);
hp(2)=plotV(V_regions,'r.','MarkerSize',markerSize);
hp(3)=plotV(V_holes,'g.','MarkerSize',markerSize);
legend(hp,{'Input mesh','Interior point(s)','Hole point(s)'},'Location','NorthWestOutside');
axisGeom(gca,fontSize); camlight headlight;
colormap(cMap); icolorbar;

hs=subplot(1,2,2); hold on;
title('Tetrahedral mesh','FontSize',fontSize);

% Visualizing using |meshView|
optionStruct.hFig=[hf,hs];
meshView(meshOutput,optionStruct);

axisGeom(gca,fontSize); 
gdrawnow;

%% Example 6: Meshing from a quadrilateral input surface
% Build a quadrilateral surface

boxDim =[12 2 3];
boxEl  =[12 2 3];
[F,V,C]=quadBox(boxDim,boxEl);

regionTetVolumes=tetVolMeanEst(F,V);
V_regions=mean(V,1); 
stringOpt='-pq1.2AaY'; %Tetgen options
V_holes=[];

%%
% Mesh using TetGen

%Create tetgen input structure
inputStruct.stringOpt=stringOpt; %Tetgen options
inputStruct.Faces=F; %Boundary faces
inputStruct.Nodes=V; %Nodes of boundary
inputStruct.faceBoundaryMarker=C; 
inputStruct.regionPoints=V_regions; %Interior points for regions
inputStruct.holePoints=V_holes; %Interior points for holes
inputStruct.regionA=regionTetVolumes; %Desired tetrahedral volume for each region

% Mesh model using tetrahedral elements using tetGen 
[meshOutput]=runTetGen(inputStruct); %Run tetGen 

%% 
% Access mesh output structure

E=meshOutput.elements; %The elements
V=meshOutput.nodes; %The vertices or nodes
CE=meshOutput.elementMaterialID; %Element material or region id
Fb=meshOutput.facesBoundary; %The boundary faces
Cb=meshOutput.boundaryMarker; %The boundary markers

%%
% Visualization

hf=cFigure; 
subplot(1,2,1); hold on;
title('Input boundaries','FontSize',fontSize);
hp(1)=gpatch(F,V,C,'k',faceAlpha1);
hp(2)=plotV(V_regions,'r.','MarkerSize',markerSize);
legend(hp,{'Input mesh','Interior point(s)'},'Location','NorthWestOutside');
axisGeom(gca,fontSize); camlight headlight;
colormap(cMap); icolorbar;

hs=subplot(1,2,2); hold on;
title('Tetrahedral mesh','FontSize',fontSize);

% Visualizing using |meshView|
optionStruct.hFig=[hf,hs];
meshView(meshOutput,optionStruct);

axisGeom(gca,fontSize); 
gdrawnow;

%% Example 7: Specifying a sizing function to control local mesh density

%%
% Build example geometry
boxDim =[12 2 3];
boxEl  =[12 2 3];
[F,V,C]=quadBox(boxDim,boxEl);
V_input=V;

%% 
% Defining a size function on the boundary nodes

%Get edge lengths and base minimum size on input edge lengths
[edgeLengths]=patchEdgeLengths(F,V);
minEdgeSize=mean(edgeLengths)/5; %The smallest element size

n=5; %The largest element edge length is n times minEdgeSize
edgeSizeField=V(:,1);
edgeSizeField=edgeSizeField-min(edgeSizeField(:));
edgeSizeField=edgeSizeField./max(edgeSizeField(:));
edgeSizeField=(edgeSizeField*(n-1))+1; %Range from 0-n depending on V(:,1) i.e. X-dir
edgeSizeField=(edgeSizeField*minEdgeSize);

regionTetVolumes=tetVolMeanEst(F,V);
V_regions=mean(V,1); 
stringOpt='-pq1.2Aa'; %Tetgen options
V_holes=[];

%%
% Mesh using TetGen

%Create tetgen input structure
inputStruct.stringOpt=stringOpt; %Tetgen options
inputStruct.Faces=F; %Boundary faces
inputStruct.Nodes=V; %Nodes of boundary
inputStruct.faceBoundaryMarker=C; 
inputStruct.regionPoints=V_regions; %Interior points for regions
inputStruct.holePoints=V_holes; %Interior points for holes
inputStruct.regionA=regionTetVolumes; %Desired tetrahedral volume for each region
inputStruct.sizeData=edgeSizeField; %The size data

% Mesh model using tetrahedral elements using tetGen 
[meshOutput]=runTetGen(inputStruct); %Run tetGen 

%% 
% Access mesh output structure

E=meshOutput.elements; %The elements
V=meshOutput.nodes; %The vertices or nodes
CE=meshOutput.elementMaterialID; %Element material or region id
Fb=meshOutput.facesBoundary; %The boundary faces
Cb=meshOutput.boundaryMarker; %The boundary markers

%%
% Visualization

hf=cFigure; 
subplot(1,2,1); hold on;
title('Input boundaries','FontSize',fontSize);
hp(1)=gpatch(F,V,'kw','none',faceAlpha1);
hp(2)=plotV(V_regions,'r.','MarkerSize',markerSize);
hp(3)=scatterV(V_input,75,edgeSizeField,'fill');
legend(hp,{'Input mesh','Interior point(s)','Sizing function points'},'Location','NorthWestOutside');
axisGeom(gca,fontSize); camlight headlight;
colormap(cMap); colorbar;
hs=subplot(1,2,2); hold on;
title('Tetrahedral mesh','FontSize',fontSize);

% Visualizing using |meshView|
optionStruct.hFig=[hf,hs];
meshView(meshOutput,optionStruct);

axisGeom(gca,fontSize); 
gdrawnow;

clear hp; 

%% Example 8: Meshing of topology with holes and complex regions 
% Simulating nested spheres with a hollow core and "tunnel" to outside

w=0.25;
r=0.1; 

[Fs1,Vs1]=geoSphere(4,1);
[Fs2,Vs2]=geoSphere(4,1-w);
[Fs3,Vs3]=geoSphere(4,1-2*w);

R=sqrt(sum(Vs1(:,[1 2]).^2,2));
logicCropVertices=R<=(r+mean(patchEdgeLengths(Fs1,Vs1))) & Vs1(:,3)>0;
logicCropFaces=any(logicCropVertices(Fs1),2);
logicCropFaces=triSurfLogicSharpFix(Fs1,logicCropFaces); 

Fs1=Fs1(~logicCropFaces,:);
Fs2=Fs2(~logicCropFaces,:); 
Fs3=Fs3(~logicCropFaces,:);

Eb=patchBoundary(Fs1);
indB=edgeListToCurve(Eb);
indB=indB(1:end-1);

cPar.closeLoopOpt=1; 
cPar.patchType='tri_slash';
[Fs4,Vs4]=polyLoftLinear(Vs3(indB,:),Vs2(indB,:),cPar);
[Fs5,Vs5]=polyLoftLinear(Vs2(indB,:),Vs1(indB,:),cPar);

[F,V,C]=joinElementSets({Fs1,Fs2,Fs3,Fs4,Fs5},{Vs1,Vs2,Vs3,Vs4,Vs5});
[F,V]=mergeVertices(F,V);
[F,V]=patchCleanUnused(F,V);

logicRegion1=ismember(C,[1 2 max(C(:))]);
logicRegion2=ismember(C,[2 3 4]);

V_inner1=getInnerPoint(F(logicRegion1,:),V);
V_inner2=getInnerPoint(F(logicRegion2,:),V);

V_regions=[V_inner1; V_inner2];

regionTetVolumes=tetVolMeanEst(F,V);
stringOpt='-pq1.2AaY'; %Tetgen options
V_holes=[];

%%
% Mesh using TetGen

%Create tetgen input structure
inputStruct.stringOpt=stringOpt; %Tetgen options
inputStruct.Faces=F; %Boundary faces
inputStruct.Nodes=V; %Nodes of boundary
inputStruct.faceBoundaryMarker=C; 
inputStruct.regionPoints=V_regions; %Interior points for regions
inputStruct.holePoints=V_holes; %Interior points for holes
inputStruct.regionA=regionTetVolumes*ones(size(V_regions,1),1); %Desired tetrahedral volume for each region

% Mesh model using tetrahedral elements using tetGen 
[meshOutput]=runTetGen(inputStruct); %Run tetGen 

%% 
% Access mesh output structure

E=meshOutput.elements; %The elements
V=meshOutput.nodes; %The vertices or nodes
CE=meshOutput.elementMaterialID; %Element material or region id
Fb=meshOutput.facesBoundary; %The boundary faces
Cb=meshOutput.boundaryMarker; %The boundary markers

%%
% Visualization

hf=cFigure; 
subplot(1,2,1); hold on;
title('Input boundaries','FontSize',fontSize);
hp(1)=gpatch(F,V,'kw','none',faceAlpha1);
hp(2)=plotV(V_regions,'r.','MarkerSize',markerSize);
legend(hp,{'Input mesh','Interior point(s)'},'Location','NorthWestOutside');
axisGeom(gca,fontSize); camlight headlight;
colormap(cMap); colorbar;
hs=subplot(1,2,2); hold on;
title('Tetrahedral mesh','FontSize',fontSize);

% Visualizing using |meshView|
optionStruct.hFig=[hf,hs];
meshView(meshOutput,optionStruct);

axisGeom(gca,fontSize); 
gdrawnow;

clear hp; 

%% Example 9: Meshing 10-node (i.e. quadratic) tetrahedral elements

% Building spherical surface models
[F,V,~]=geoSphere(2,1);
C=ones(size(F,1),1);
V_regions=[0 0 0];
V_holes=[];
regionTetVolumes=tetVolMeanEst(F,V);
stringOpt='-pq1.2AaYQ';

%%
% Mesh using TetGen

%Create tetgen input structure
inputStruct.stringOpt=stringOpt; %Tetgen options
inputStruct.Faces=F; %Boundary faces
inputStruct.Nodes=V; %Nodes of boundary
inputStruct.faceBoundaryMarker=C; 
inputStruct.regionPoints=V_regions; %Interior points for regions
inputStruct.holePoints=V_holes; %Interior points for holes
inputStruct.regionA=regionTetVolumes; %Desired tetrahedral volume for each region
inputStruct.tetType='tet10'; %Set desired element type

% Mesh model using tetrahedral elements using tetGen 
[meshOutput]=runTetGen(inputStruct); %Run tetGen 

%% 
% Access mesh output structure

E=meshOutput.elements; %The elements
V=meshOutput.nodes; %The vertices or nodes
CE=meshOutput.elementMaterialID; %Element material or region id
Fb=meshOutput.facesBoundary; %The boundary faces
Cb=meshOutput.boundaryMarker; %The boundary markers

%%
% Visualization

%Selecting half of the model to see interior
Y=V(:,2); YE=mean(Y(E),2);
logicCutView=YE>mean(Y);
[Fs,Cs]=element2patch(E(logicCutView,:),CE(logicCutView),'tet10');

hf=cFigure; 
subplot(1,2,1); hold on;
title('Input boundaries','FontSize',fontSize);
hp(1)=gpatch(F,V,C,'k',faceAlpha1);
hp(2)=plotV(V_regions,'r.','MarkerSize',markerSize);
legend(hp,{'Input mesh','Interior point(s)'},'Location','NorthWestOutside');
axisGeom(gca,fontSize); camlight headlight;
colormap(cMap); icolorbar;

hs=subplot(1,2,2); hold on;
title('Tetrahedral mesh','FontSize',fontSize);

title('Cut view of tetrahedral mesh model','FontSize',fontSize);
gpatch(Fb,V,0.5*ones(1,3),'none',faceAlpha1);
gpatch(Fs,V,Cs,'k',faceAlpha2);
% patchNormPlot(Fs,V);

plotV(V(unique(Fs(:)),:),'k.','MarkerSize',markerSize);
camlight headlight;
axisGeom(gca,fontSize); 
colormap(cMap); 
gdrawnow;

%% 
%
% <<gibbVerySmall.gif>>
% 
% _*GIBBON*_ 
% <www.gibboncode.org>
% 
% _Kevin Mattheus Moerman_, <gibbon.toolbox@gmail.com>
 
%% 
% _*GIBBON footer text*_ 
% 
% License: <https://github.com/gibbonCode/GIBBON/blob/master/LICENSE>
% 
% GIBBON: The Geometry and Image-based Bioengineering add-On. A toolbox for
% image segmentation, image-based modeling, meshing, and finite element
% analysis.
% 
% Copyright (C) 2006-2023 Kevin Mattheus Moerman and the GIBBON contributors
% 
% This program is free software: you can redistribute it and/or modify
% it under the terms of the GNU General Public License as published by
% the Free Software Foundation, either version 3 of the License, or
% (at your option) any later version.
% 
% This program is distributed in the hope that it will be useful,
% but WITHOUT ANY WARRANTY; without even the implied warranty of
% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
% GNU General Public License for more details.
% 
% You should have received a copy of the GNU General Public License
% along with this program.  If not, see <http://www.gnu.org/licenses/>.

##### SOURCE END #####
--></body></html>
